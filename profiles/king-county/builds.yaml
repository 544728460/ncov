# Define locations for which builds should be created.
# For each build we specify a subsampling scheme via an explicit key.
# If the name of the focal geography differs from the build name this needs to
# be specified explicity as geographic_name. In addition, we require the
# geographic scale the build focuses on. Together name and scale serve a look-up
# in the geo_hierarchy to define region, country, division, etc
builds:
  global:
    subsampling_scheme: region_global
    geographic_scale: region
  usa:
    subsampling_scheme: country
    geographic_scale: country
    region: North America
    country: USA
  usa_washington:
    subsampling_scheme: division
    geographic_scale: division
    region: North America
    country: USA
    division: Washington
  usa_washington_king-county:
    subsampling_scheme: county
    geographic_scale: location
    region: North America
    country: USA
    division: Washington
    location: King County

# Custom subsampling logic for county-level builds.
subsampling:
  county:
    # Focal samples for location
    focal:
      group_by: "year month"
      seq_per_group: 300
      # Use augur filter's query argument to filter strains with pandas-style logic expressions.
      # This can be easier to read than the corresponding filter by exclusion.
      query: --query "(country == '{country}') & (division == '{division}') & (location == '{location}')"

    # Samples that are genetically related to the focal samples
    related:
      group_by: "country year month"
      seq_per_group: 20
      exclude: "--exclude-where 'location={location}'"
      priorities:
        type: "proximity"
        focus: "focal"

    # Contextual samples from the rest of the world
    contextual:
      group_by: "country year month"
      seq_per_group: 10
      exclude: "--exclude-where 'location={location}'"
